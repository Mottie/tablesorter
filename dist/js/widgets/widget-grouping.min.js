/*! tablesorter Grouping widget - updated 10/26/2014 (v2.18.0)
 * Requires tablesorter v2.8+ and jQuery 1.7+
 * by Rob Garrison
 */
!function(a){"use strict";var b=a.tablesorter;b.grouping={_columnDirection:function(a){return a.hasClass(b.css.sortAsc)?0:a.hasClass(b.css.sortDesc)?1:2},grouperConstructors:{},addGrouperConstructor:function(b,c){var d={};d[b]=c,a.extend(this.grouperConstructors,d)},columnGrouper:function(a,b){var c=(b.attr("class")||"").match(/(group-\w+(-\w+)?)/g),d=c?c[0].split("-"):["group","letter",1],e=d[1],f="date"===e?d[2]:parseInt(d[2]||1,10)||1,g=this.grouperConstructors[e];return g&&g(a,b,f)},groupHeaderHTML:function(a,b,c){return'<tr class="group-header '+a.selectorRemove.slice(1)+'" unselectable="on"><td colspan="'+a.columns+'">'+(b.group_collapsible?"<i/>":"")+'<span class="group-name">'+c+'</span><span class="group-count"></span></td></tr>'},_insertGroupHeaders:function(c,d,e,f,g){var h,i,j,k,l,m="",n=!1;for(e.group_currentGroup="",e.group_collapsedGroups={},e.group_collapsible&&e.group_saveGroups&&b.storage&&(e.group_collapsedGroups=b.storage(c,"tablesorter-groups")||{},e.group_currentGroup=f.grouperId(),e.group_collapsedGroups[e.group_currentGroup]?n=!0:e.group_collapsedGroups[e.group_currentGroup]=[]),i=0;i<d.$tbodies.length;i++)for(l=d.cache[i].normalized,m="",h=0;h<l.length;h++)k=l[h][d.columns].$row.eq(0),k.is(":visible")&&(j=f.rowGroup(l[h]),m!==j&&(m=j,a.isFunction(e.group_formatter)&&(j=e.group_formatter((j||"").toString(),g,c,d,e)||j),k.before(this.groupHeaderHTML(d,e,j)),e.group_saveGroups&&!n&&e.group_collapsed&&e.group_collapsible&&e.group_collapsedGroups[e.group_currentGroup].push(j)))},_markupGroupHeader:function(b,c,d,e,f){var g;(c.group_count||a.isFunction(c.group_callback))&&(g=e.find(".group-count"),g.length&&(c.group_count&&g.html(c.group_count.replace(/\{num\}/g,f.length)),a.isFunction(c.group_callback)&&c.group_callback(e.find("td"),f,d,b)))},_collapseGroupHeaderIfNecessary:function(b,c,d,e){var f,g;c.group_saveGroups&&c.group_collapsedGroups[c.group_currentGroup].length?(g=d.find(".group-name").text().toLowerCase(),f=a.inArray(g,c.group_collapsedGroups[c.group_currentGroup])>-1,d.toggleClass("collapsed",f),e.toggleClass("group-hidden",f)):c.group_collapsed&&c.group_collapsible&&(d.addClass("collapsed"),e.addClass("group-hidden"))},_processGroupHeaders:function(c,d,e,f){d.$table.find("tr.group-header").bind("selectstart",!1).each(function(){var d=a(this),g=d.nextUntil("tr.group-header").filter(":visible");b.grouping._markupGroupHeader(c,e,f,d,g),b.grouping._collapseGroupHeaderIfNecessary(c,e,d,g)})},update:function(b,c,d){if(!a.isEmptyObject(c.cache)){var e,f,g=c.sortList[0]?c.sortList[0][0]:-1;c.$table.find("tr.group-hidden").removeClass("group-hidden").end().find("tr.group-header").remove(),d.group_collapsible&&c.$table.data("pagerSavedHeight",0),0>g||(e=c.$headerIndexed[g],f=this.columnGrouper(c,e),g>=0&&!e.hasClass("group-false")&&f&&(this._insertGroupHeaders(b,c,d,f,g),this._processGroupHeaders(b,c,d,g),c.$table.trigger(d.group_complete)))}},bindEvents:function(c,d,e){e.group_collapsible&&(e.group_collapsedGroups={},d.$table.on("click toggleGroup","tr.group-header",function(f){f.stopPropagation();var g,h,i,j=a(this),k=j.find(".group-name").text().toLowerCase();"click"===f.type&&f.shiftKey&&j.siblings(".group-header").trigger("toggleGroup"),j.toggleClass("collapsed"),j.nextUntil("tr.group-header").toggleClass("group-hidden",j.hasClass("collapsed")),e.group_saveGroups&&b.storage&&(h=d.$table.find(".group-header"),g=j.hasClass("collapsed"),e.group_collapsedGroups[e.group_currentGroup]||(e.group_collapsedGroups[e.group_currentGroup]=[]),g&&e.group_currentGroup?e.group_collapsedGroups[e.group_currentGroup].push(k):e.group_currentGroup&&(i=a.inArray(k,e.group_collapsedGroups[e.group_currentGroup]),i>-1&&e.group_collapsedGroups[e.group_currentGroup].splice(i,1)),b.storage(c,"tablesorter-groups",e.group_collapsedGroups))})),a(e.group_saveReset).on("click",function(){b.grouping.clearSavedGroups(c)}),d.$table.on("pagerChange.tsgrouping",function(){b.grouping.update(c,d,e)})},clearSavedGroups:function(a){a&&b.storage&&(b.storage(a,"tablesorter-groups",""),this.update(a,a.config,a.config.widgetOptions))}},b.grouping.addGrouperConstructor("number",function(a,c,d){var e=c.data("column");return d=d||1,1==d?{rowGroup:function(a){var b=a[e];return parseFloat(b)||b},grouperId:function(){return""+e+"groupnumber1"}}:{rowGroup:function(a){var f,g=a[e];return""===g?"":(f=c.hasClass(b.css.sortAsc)?Math.floor(parseFloat(g)/d)*d:Math.ceil(parseFloat(g)/d)*d,f+" - "+(f+(d-1)*(c.hasClass(b.css.sortAsc)?1:-1)))},grouperId:function(){return""+e+"dir"+b.grouping._columnDirection(c)+"groupnumber"+d}}}),b.grouping.addGrouperConstructor("separator",function(b,c,d){var e=c.data("column");return d=d||1,{rowGroup:function(c){var f=(c[e]+"").split(b.widgetOptions.group_separator);return a.trim(f[d-1]||"")},grouperId:function(){return""+e+"groupseparator"+d}}}),b.grouping.addGrouperConstructor("text",function(a,b){var c=b.data("column");return{rowGroup:function(a){return a[c]+""},grouperId:function(){return""+c+"grouptext"}}}),b.grouping.addGrouperConstructor("word",function(a,b,c){var d=b.data("column");return c=c||1,{rowGroup:function(a){var b=a[d],e=(b+" ").match(/\w+/g)||[];return e[c-1]||""},grouperId:function(){return""+d+"groupword"+c}}}),b.grouping.addGrouperConstructor("letter",function(a,b,c){var d=b.data("column");return c=c||1,{rowGroup:function(a){var b=a[d];return b?(b+" ").substring(0,c):""},grouperId:function(){return""+d+"groupletter"+c}}}),b.grouping.addGrouperConstructor("date",function(a,b,c){var d=a.widgetOptions,e=b.data("column");return{rowGroup:function(a){var b,f,g,h,i=a[e],j=new Date(i||"");switch(c){case"year":return j.getFullYear();case"month":return d.group_months[j.getMonth()];case"monthyear":return d.group_months[j.getMonth()]+" "+j.getFullYear();case"day":return d.group_months[j.getMonth()]+" "+j.getDate();case"week":return d.group_week[j.getDay()];case"time":return b=j.getHours(),f=("00"+(b>12?b-12:0===b?b+12:b)).slice(-2),g=("00"+j.getMinutes()).slice(-2),h=("00"+d.group_time[b>=12?1:0]).slice(-2),f+":"+g+" "+h;default:return d.group_dateString(j)}},grouperId:function(){return""+e+"groupdate"+c}}}),b.addWidget({id:"group",priority:100,options:{group_collapsible:!0,group_collapsed:!1,group_saveGroups:!0,group_saveReset:null,group_count:" ({num})",group_separator:"-",group_formatter:null,group_callback:null,group_complete:"groupingComplete",group_months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],group_week:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],group_time:["AM","PM"],group_dateString:function(a){return a.toLocaleString()}},init:function(a,c,d,e){b.grouping.bindEvents(a,d,e)},format:function(a,c,d){b.grouping.update(a,c,d)},remove:function(a,b){b.$table.off("click","tr.group-header").off("pagerChange.tsgrouping").find(".group-hidden").removeClass("group-hidden").end().find("tr.group-header").remove()}})}(jQuery);